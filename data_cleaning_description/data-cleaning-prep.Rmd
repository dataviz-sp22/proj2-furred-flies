---
title: "R Notebook"
output: github_document
---

This file contains the code we used to obtain and clean the data.

```{r}
library(RAQSAPI)
library(tidyverse)
library(stringr)
library(sjmisc)
library(keyring)
library(reprex)

# Please follow instructions in data README to set up a RAQSAPI account so that you are able to run this line of code with YOUR email and key
# RAQSAPI::aqs_credentials("email", "key")

# Loading my own necessary information using the function keyring
datamartAPI_user <- "cweis22@uchicago.edu"
server <- "AQSDatamart"

key <- key_get(service = server, username = datamartAPI_user)

aqs_credentials(username = datamartAPI_user, key)

# To read RAQSAPI documentation
# RShowDoc(what="RAQSAPIvignette", type="html", package="RAQSAPI")
```


```{r}
aqs_classes()

# Loading California state data
# Data for California from 2011 to 2021 - only year matters in bdate/edate variables
CA1 <- aqs_quarterlysummary_by_state(parameter = c("88502", "42101", "42602", "44201", "81102", "88101", "42401"), bdate = as.Date("20110101", format = "%Y%m%d"), edate = as.Date("20210101", format = "%Y%m%d"), "06")

# CA1_splice <- CA1 |>
#   select(c(year,quarter,sample_duration,sample_duration_code,sample_duration_type,
#            state_code,county_code,county,latitude,longitude,parameter,units_of_measure,
#            arithmetic_mean,maximum_value,state,cbsa_code,cbsa)) |>
#   mutate(row = row_number()) |>
#   mutate(year_qtr = paste(year, quarter, sep = "_"))

CA1_splice <- CA1 |>
  select(c(year,quarter,state_code,county_code,county,latitude,longitude,parameter,
           arithmetic_mean,state,cbsa_code,cbsa)) |>
  mutate(year_qtr = paste(year, quarter, sep = "_")) |>
  mutate(row = row_number()) |>
  pivot_wider(names_from = parameter, values_from = arithmetic_mean)

CA1_avg <- CA1_splice |>
  mutate(Ozone = round(CA1_splice$Ozone, 3), "PM2.5 - Local Conditions" = 
           round(CA1_splice$`PM2.5 - Local Conditions`, 1),
         )     
  
  
  
v <- round(CA1_splice$Ozone, 3)
  


  mutate(index_ozone = )

head(CA1)

# No need to include the below in proposalâ€”just say that we will repeat the above code for each 10-year increment from 1971 to 2021, and for all 50 states plus DC
# Data for California from 2001 to 2011 - only year matters in bdate/edate variables
CA2 <- aqs_quarterlysummary_by_state(parameter = c("88502", "42101", "42602", "44201", "81102", "88101", "42401"), bdate = as.Date("20010101", format = "%Y%m%d"), edate = as.Date("20100101", format = "%Y%m%d"), "06")

# Data for California from 1991 to 2001 - only year matters in bdate/edate variables
CA3 <- aqs_quarterlysummary_by_state(parameter = c("88502", "42101", "42602", "44201", "81102", "88101", "42401"), bdate = as.Date("19910101", format = "%Y%m%d"), edate = as.Date("20000101", format = "%Y%m%d"), "06")

# Data for California from 1981 to 1991 - only year matters in bdate/edate variables
CA3 <- aqs_quarterlysummary_by_state(parameter = c("88502", "42101", "42602", "44201", "81102", "88101", "42401"), bdate = as.Date("19810101", format = "%Y%m%d"), edate = as.Date("19900101", format = "%Y%m%d"), "06")

# Data for California from 1971 to 1981 - only year matters in bdate/edate variables
CA3 <- aqs_quarterlysummary_by_state(parameter = c("88502", "42101", "42602", "44201", "81102", "88101", "42401"), bdate = as.Date("19710101", format = "%Y%m%d"), edate = as.Date("19800101", format = "%Y%m%d"), "06")
```
